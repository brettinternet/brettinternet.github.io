---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

vars:
  PROJECT_DIR:
    sh: git rev-parse --show-toplevel

env:
  ROOT_DIR: "{{.PROJECT_DIR}}"
  HUGO_BUILD_VERSION: dev
  HUGO_BUILD_TIME:
    sh: date -u +"%Y-%m-%dT%H:%M:%SZ"

includes:
  setup: .taskfiles/setup.yaml

tasks:
  default:
    silent: true
    cmds:
      - task -l

  init:
    desc: Install dependencies and setup environment
    cmds:
      - task: setup:init

  start:
    desc: Run development server
    cmds:
      - hugo server --navigateToChanged --gc

  start-drafts:
    desc: Run development server with drafts
    cmd: hugo server --navigateToChanged --buildDrafts

  build:
    desc: Build production static site
    cmds:
      - hugo

  check:
    desc: Run all checks
    cmds:
      - bun run check
      - dprint check

  fix:
    desc: Run all checks
    cmds:
      - bun run fix
      - dprint fmt

  remote:
    desc: Open the remote GitHub repository in default browser
    cmd: >
      {{if eq OS "darwin"}}open{{else if eq OS "linux"}}xdg-open{{else if eq OS "windows"}}start{{else}}open{{end}}
      $(git remote get-url origin | sed 's/\.git$//' | sed 's|git@github.com:|https://github.com/|')
