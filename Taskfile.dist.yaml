---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: "3"

vars:
  PROJECT_DIR:
    sh: git rev-parse --show-toplevel

env:
  ROOT_DIR: "{{.PROJECT_DIR}}"

includes:
  lint: .taskfiles/lint.yaml
  precommit: .taskfiles/precommit.yaml
  setup: .taskfiles/setup.yaml

tasks:
  default:
    silent: true
    cmds:
      - task -l

  init:
    desc: Install dependencies and setup environment
    cmds:
      - task: setup:init
      - task: precommit:init
      - task: precommit:update
      - task: node-modules-install

  start:
    desc: Run development server
    cmds:
      - hugo server --navigateToChanged --gc

  start-drafts:
    desc: Run development server with drafts
    cmd: hugo server --navigateToChanged --buildDrafts

  build:
    desc: Build production static site
    cmds:
      - hugo

  node-modules-install:
    cmds:
      - bun install
    status:
      - test -d node_modules

  check:
    desc: Run all checks
    cmds:
      - bun run check
      - task: precommit:run

  fix:
    desc: Run all checks
    cmds:
      - bun run fix
      - task: precommit:run
