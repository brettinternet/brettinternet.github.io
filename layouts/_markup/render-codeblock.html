{{ $result := transform.HighlightCodeBlock . }}
{{ $title := .Attributes.title }}
{{ $open := .Attributes.open | default true }}
{{ if .Attributes.closed }}
{{ $open = false }}
{{ end }}
{{ if $title }}
<details {{if $open}}open {{end}}class="group/codeblock relative{{if $title }} border-4 border-slate-600 rounded-md{{ end }} my-6">
  {{ $lang := .Type }}
  <summary class="relative px-3 py-2 text-sm font-medium bg-slate-600 text-slate-200 font-mono">
    <span>{{ $title }}</span>
    <button class="copy-btn hidden opacity-0 group-hover/codeblock:opacity-100 cursor-pointer absolute top-[50%] -translate-y-[50%] right-2 px-2 py-1 bg-slate-700 hover:bg-slate-800 text-slate-300 text-xs rounded border border-slate-600 transition-opacity duration-200" aria-label="Copy code">
      Copy
    </button>
  </summary>
  <div class="relative overflow-x-auto py-2 bg-slate-900 rounded-md {{ if $title }}rounded-t-none{{ end }}">
    {{ $wrapped := $result.Wrapped | replaceRE `<pre([^>]*)>` `<pre$1 class="!rounded-none !m-0 !bg-slate-900 !p-1 !text-[14px]">` }}
    {{ $wrapped | safeHTML }}
  </div>
</details>
{{ else }}
<div class="group/codeblock relative overflow-x-auto my-6">
  <button class="copy-btn hidden opacity-0 group-hover/codeblock:opacity-100 cursor-pointer absolute top-2 right-2 px-2 py-1 bg-slate-700 hover:bg-slate-600 text-slate-300 text-xs rounded border border-slate-600 transition-opacity duration-200" aria-label="Copy code">
    Copy
  </button>
  {{ $wrapped := $result.Wrapped | replaceRE `<pre([^>]*)>` `<pre$1 class="!bg-slate-900 !m-0">` }}
  {{ $wrapped | safeHTML }}
</div>
{{ end }}
