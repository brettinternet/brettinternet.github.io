{{ define "main" }}
  <article class="w-full mx-auto mb-8 px-4 md:px-0{{with .Params.article_class}} {{.}}{{end}}">
    {{ if not (and .Params.hide_title .Params.hide_date .Params.hide_image) }}
    <div class="mb-8 space-y-4">
      {{ $hasImage := and (not .Params.hide_image) (gt (len (.Resources.ByType "image")) 0) }}
      <div class="{{if $hasImage}}text-center {{end}}max-w-prose mx-auto w-full">
        {{ if not .Params.hide_title }}
        <h1 class="font-serif text-5xl mb-2">{{.Title}}</h1>
        {{ end }}
        {{ if not .Params.hide_date }}
        {{ with .PublishDate }}
        <p class="font-light text-xs"><time>{{ .Format "2006-01-02" }}</time></p>
        {{ end }}
        {{ end }}
      </div>
      {{ if not .Params.hide_image }}
        {{ $image := .Resources.GetMatch .Params.post_image }}
        {{ if not $image }}
          {{ $image = .Resources.GetMatch .Params.card_image }}
        {{ end }}
        {{ if not $image }}
          {{ $image = index (.Resources.ByType "image") 0 }}
        {{ end }}
        {{ if $image }}
          {{ $maxWidth := 900 }}
          {{ $width := cond (lt $image.Width $maxWidth) $image.Width $maxWidth }}
          {{ $image = $image.Resize (printf "%dx Lanczos" $width) }}
          {{ $alt := $image.Params.Alt }}
          {{ $caption := $image.Params.Caption }}
          {{ $params := dict
            "context" .
            "image" $image
            "alt" $alt
            "caption" $caption
            "image_class" "border border-solid border-slate-400 mx-auto"
            "figure" true
          }}
          {{ partial "image.html" $params }}
        {{ end }}
      {{ end }}
    </div>
    {{ end }}
    <div class="prose prose-slate mx-auto w-full">
      {{.Content}}
    </div>
  </article>
  {{ if .Params.comments }}
  <div class="container mx-auto max-w-xl mt-24 px-4 md:px-0">
    {{ partial "giscus.html" }}
  </div>
  {{ end }}
{{ end }}
