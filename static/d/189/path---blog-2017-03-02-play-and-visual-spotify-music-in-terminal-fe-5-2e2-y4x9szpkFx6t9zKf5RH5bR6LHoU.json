{"data":{"site":{"siteMetadata":{"siteRepo":null}},"markdownRemark":{"id":"81222bb8-2b49-5327-afb8-94029214389b","excerpt":"Like Winamp, ncmpcpp is timeless classic for music applications. As I’ve picked up my work and slowly moved into the command-line space, I’ve found ncmpcpp very…","html":"<p>Like Winamp, ncmpcpp is timeless classic for music applications. As I’ve picked up my work and slowly moved into the command-line space, I’ve found ncmpcpp very easy to use. <a href=\"https://wiki.archlinux.org/index.php/ncmpcpp\">Ncmpcpp</a> is an mpd client and coupled with Mopidy I can browse Spotify playlists, search for artists, and play top tracks.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brew install ncmpcpp</code></pre></div>\n<p>My latest endeavor with managing my music on the CLI has been to use a visualizer like <a href=\"https://github.com/dpayne/cli-visualizer\">cli-visualizer</a> or even ncmpcpp’s native visualization. It’s a fairly simple setup that’s been around for a while with a standard mpd and mpd client like ncmpcpp. However, to use an mpd client with a streaming service like Spotify or Soundcloud, you have to use a service like Mopidy.</p>\n<h2>Without Spotify</h2>\n<p>If you don’t stream music, you’re able to stick with a normal <a href=\"https://wiki.archlinux.org/index.php/Music_Player_Daemon\">mpd</a> setup.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brew install mpd</code></pre></div>\n<p>Using a Music Player Daemon to serve audio has been around for a while, so I won’t get into this. The final config should look something like <a href=\"https://github.com/brettinternet/dotfiles/blob/master/.mpd/mpd.conf\">this</a>. Make sure you setup the entire config correctly, however, I’ll highlight a key element here: the two audio outputs. The visualizers both in ncmpcpp and in cli-visualizer need the <code class=\"language-text\">fifo</code> audio output to work:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">audio_output <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">type</span>                  <span class=\"token string\">\"fifo\"</span>\n  name                  <span class=\"token string\">\"my_fifo\"</span>\n  path                  <span class=\"token string\">\"/tmp/mpd.fifo\"</span>\n  <span class=\"token function\">format</span>                <span class=\"token string\">\"44100:16:2\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And macOS uses CoreAudio for it’s sound hardware output, so we’ll add another output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">audio_output <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">type</span>                  <span class=\"token string\">\"osx\"</span>\n  name                  <span class=\"token string\">\"CoreAudio\"</span>\n  mixer_type            <span class=\"token string\">\"software\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>With Spotify</h2>\n<p>Install <a href=\"https://github.com/mopidy\">Mopidy</a> and Mopidy-Spotify. They have additional plugins for other streaming services.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brew install mopidy mopidy-spotify</code></pre></div>\n<p>Run <code class=\"language-text\">mopidy</code> once so the default config files are created. On macOS the config is <code class=\"language-text\">~/.config/mopidy/mopidy.conf</code>. Check out <a href=\"https://github.com/brettinternet/dotfiles/blob/master/.config/mopidy/mopidy.conf\">my config here</a>. The key component I wrestled with here was the split audio output.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>audio<span class=\"token punctuation\">]</span>\noutput <span class=\"token operator\">=</span> <span class=\"token function\">tee</span> name<span class=\"token operator\">=</span>t t. <span class=\"token operator\">!</span> queue <span class=\"token operator\">!</span> autoaudiosink t. <span class=\"token operator\">!</span> queue <span class=\"token operator\">!</span> audioresample <span class=\"token operator\">!</span> audioconvert <span class=\"token operator\">!</span> audio/x-raw,rate<span class=\"token operator\">=</span>44100,channels<span class=\"token operator\">=</span>2,format<span class=\"token operator\">=</span>S16LE <span class=\"token operator\">!</span> wavenc <span class=\"token operator\">!</span> filesink location<span class=\"token operator\">=</span>/tmp/mpd.fifo</code></pre></div>\n<p>Using a tee gstreamer element, we’re able to use two audio outputs. Check out Mopidy’s documentation for <a href=\"https://docs.mopidy.com/en/latest/audio/\">advanced audio setups</a> for more details.</p>\n<p>You may have also noticed <code class=\"language-text\">spotify_tunigo</code> in the <code class=\"language-text\">mopidy.conf</code> below the Spotify options. <a href=\"https://github.com/trygveaa/mopidy-spotify-tunigo\">Spotify Tunigo</a> let’s you browser Spotify’s curated playlists and checkout new music.</p>\n<p>Install Spotify Tunigo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pip install Mopidy-Spotify-Tunigo</code></pre></div>\n<p>It’s also important to note the Spotify settings in <code class=\"language-text\">mopidy.conf</code>. Storing passwords in plaintext is bad. There’s a current work-around with python and <a href=\"https://github.com/mopidy/mopidy/issues/116#issuecomment-18026012\">an open issue</a> to improve this. Of course, it’s always best practice to use unique passwords for everything.</p>\n<p>Now let’s run <code class=\"language-text\">mopidy</code> to make sure you don’t get any errors. When I set up mine on macOS, I had a python error about a missing libspotify framework in <code class=\"language-text\">/Library/Frameworks</code>. If you get this error, simply run <code class=\"language-text\">brew info libspotify</code> to see where homebrew has installed your libspotify package. Create a folder in <code class=\"language-text\">/Library/Frameworks</code> called <code class=\"language-text\">libspotify.framework</code>, then create a symlink in <code class=\"language-text\">/Library/Frameworks/libspotify.framework</code> with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ln -s /usr/local/Cellar/libspotify/12.1.51/lib/libspotify /Library/Frameworks/libspotify.framework/libspotify</code></pre></div>\n<p>Once you’ve confirmed there aren’t any runtime errors, you can now run mopidy as a service.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brew services start mopidy</code></pre></div>\n<p>Now let’s run <code class=\"language-text\">ncmpcpp</code>. Jump to the music browser with <code class=\"language-text\">2</code> and pick some Spotify tracks to play on the current playlist queue. <code class=\"language-text\">8</code> will take you to ncmpcpp’s visualizer. If you’ve install <a href=\"https://github.com/dpayne/cli-visualizer\">cli-visualizer</a> you can run it with <code class=\"language-text\">vis</code>. Here are some of my preferred settings in <code class=\"language-text\">./config/vis/config</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">visualizer.spectrum.top.margin=0.30\naudio.stereo.enabled=false</code></pre></div>\n<p>Some problems I’m working through with this setup: I noticed that when I change tracks or pause/stop and then resume playback in ncmpcpp, the cli-visualizer won’t resume animation.</p>\n<p>My next task is to get the cli-visualizer output to work on my mac’s desktop as an <a href=\"http://tracesof.net/uebersicht/\">Ubersicht</a> widget.</p>","frontmatter":{"title":"Play and Visualize Spotify Music in Terminal with Mopidy and Ncmpcpp","date":"March 02, 2017","tags":["music","cli"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2017-03-02-play-and-visual-spotify-music-in-terminal/","previous":null,"next":{"fields":{"slug":"/2017-04-23-build-a-hackintosh/"},"frontmatter":{"title":"Building a Hackintosh"}}}}